# README.md

## Описание проекта

В рамках данного проекта мы занимались задачей восстановления параметров частиц на основе данных, полученных с помощью CORSIKA.   
Особенностью задачи было то, что изначально доступный объём данных был ограничен, а целевые переменные сложные, с разными физическими свойствами.  

Цель работы — протестировать разные подходы к решению задачи и показать жюри сравнительный анализ результатов, чтобы обосновать выбор лучших методов.

---

## Структура проекта

1. Catboost_model.ipynb - Базовый CatBoost
2. Catboost_multi_regression.cbm - веса CatBoost
3. lstm_model.ipynb - LSTM для парных временных признаков
4. multihead_model.ipynb - Fully Connected Multi-Head Neural Network
5. best_model_multihead.pth - веса Fully Connected Multi-Head Neural Network

---

## Дополнительная предобработка данных

### 0. Получение дополнительных переменных

Изначально у нас был ограниченный набор признаков, но нам удалось **существенно увеличить объём доступных данных**, извлекая дополнительные переменные из `.dat` файлов. Это дало модели больше информации о событиях и стало важным шагом в улучшении качества предсказаний.

### 0.1. Обработка переменной `phi`

Переменная `phi` представляет собой угол в диапазоне от **0 до 360 градусов**, что создаёт сложность при стандартном регрессионном подходе (периодичность).  
Поэтому мы решили предсказывать **cos(φ)** и **sin(φ)** отдельно, а затем восстанавливать угол с помощью функции **arctangent2**:

phi_pred = arctan2(sin_pred, cos_pred)


Этот подход позволяет корректно учитывать границы окружности и улучшает стабильность предсказаний.

---

## Тестирование различных моделей

### 1. Базовый CatBoost

Мы построили стандартную модель CatBoost для всех целевых переменных.  
Результаты по RMSE (чем меньше — тем лучше):

| Target  | RMSE   | R²     |
|----------|--------|--------|
| power    | 0.0979 | 0.9748 |
| age      | 0.0514 | 0.3778 |
| x        | 10.0690| 0.8089 |
| y        | 13.0285| 0.8892 |
| tetta    | 4.5506| 0.8535|
| phi      | 103.7833 | - |

**Вывод:**  
CatBoost дал базовый результат, но видно, что особенно по пространственным координатам (`x`, `y`, `tetta`) и по `phi` качество предсказаний оставляет желать лучшего. Это послужило мотивацией для поиска более сложных архитектур. С другой стороны, он вырвался далеко вперед по power.

---

### 2. LSTM для парных временных признаков (energy и threshold_time)

В ходе анализа данных мы заметили, что переменные **energy** и **threshold_time** представляют собой пары временных рядов, характерных для событий.  
Поэтому мы применили модель LSTM для их обработки.

**Результаты LSTM:**

| Target  | RMSE   | MAE   | R²    |
|----------|--------|-------|-------|
| power    | 0.4435 | 0.2727 | 0.4830 |
| age      | 0.0640 | 0.0496 | 0.0382 |
| x        | 9.1183 | 6.4189 | 0.8433 |
| y        | 11.2542| 7.4314 | 0.9173 |
| tetta    | 4.5490 | 3.2865 | 0.8536 |
| phi      | 103.4708 | 89.6362 | - |

**Дополнительные метрики для phi:**

- Точность внутри 5°: **2.82%**
- Точность внутри 10°: **5.55%**

**Вывод:**  
LSTM значительно улучшил качество по координатам (`x`, `y`), по углу `tetta` и по мощности (`power`).  
Это подтверждает гипотезу о том, что использование временных зависимостей было правильным шагом.

---

### 3. Fully Connected Multi-Head Neural Network

Для финального этапа мы обучили полносвязную multi-head нейронную сеть, которая одновременно предсказывает все параметры.

**Результаты:**

| Target  | RMSE   |
|----------|--------|
| power    | 0.4145 |
| age      | 0.0620 |
| x        | 10.2218|
| y        | 11.3880|
| tetta    | 4.0055 |
| phi      | 104.1952 |

**Дополнительные метрики для phi:**

- MAE: **90.3283 градусов**
- Точность внутри 5°: **2.69%**
- Точность внутри 10°: **5.66%**

**Вывод:**  
Multi-head сеть показала наилучший баланс по RMSE практически для всех параметров, кроме `phi`, где результат остался сопоставим с другими методами.

---

## Итоговое сравнение по RMSE:
power - RMSE: , R²: 0.9748
age - RMSE: ч, R²: 0.3778
x - RMSE: , R²: 0.8089
y - RMSE: , R²: 0.8892
tetta - RMSE: , R²: 0.8535
phi -  
| Model   | Power | Age  | X      | Y      | Tetta  | Phi   |
|----------|--------|-------|--------|--------|--------|--------|
| CatBoost | **0.0979** | 0.0979 | 10.0690 | 13.0285 | 4.5506 | 103.7833 |
| LSTM     | 0.4435 | 0.0640 | **9.1183** | **11.2542** | 4.5490 | **103.4708** |
| MultiHead NN | 0.4145 | **0.0620** | 10.2218 | 11.3880 | **4.0055** | 104.1952 |

---

## Основные выводы

- **Обогащение данных** (доп. переменные из `.dat` файлов) позволило нам построить более точные модели.
- Для **временных признаков** (energy, threshold_time) LSTM оказался лучшим выбором.
- **Полносвязная multi-head сеть** показала лучший общий RMSE на большинстве параметров.
- Для угловых переменных мы применяли специальную обработку через синус и косинус, чтобы учитывать периодичность.
- CatBoost показал результаты, сравнимые с остальными решениями, но по предсказанию power оказался заметно лучше
---
